---
# tasks for minio_server_install.linux
#
# Set Environment
#
- name: Import facts based on distribution
  include_vars: "{{ inner_item }}"
  with_first_found:
    - files:
        - "{{ ansible_distribution|lower }}.yml"
        - default.yml
      paths: 'vars/'
  loop_control:
    loop_var: inner_item

- name: Import facts based on distribution version
  include_vars: "{{ inner_item }}"
  with_first_found:
    - files:
        - "{{ ansible_distribution | lower }}{{ ansible_distribution_major_version }}.yml"
        - default.yml
      paths: 'vars/'
  loop_control:
    loop_var: inner_item


- name: Configure Minio user
  include_tasks: minio/users.yml
  tags: minio,users

#
# Configure volumes
#
- name: Configure logical volumes
  include_tasks: volumes.yml
  when:
    - minio_server_install_volumes is defined
  tags: minio,molecule-notest

#
# Install packages
#
# Update package manager settings
# This needs to be first so that the repo can actually be reached
- name: Include tasks for distribution
  include_tasks: "{{ inner_item }}"
  with_first_found:
    - files:
        - "{{ ansible_distribution | lower }}.yml"
        - default.yml
      paths: 'tasks/'
      skip: true
  loop_control:
    loop_var: inner_item

- name: Include tasks for distribution version
  include_tasks: "{{ inner_item }}"
  with_first_found:
    - files:
        - "{{ ansible_distribution | lower }}{{ ansible_distribution_major_version }}.yml"
        - default.yml
      paths: 'tasks/'
  loop_control:
    loop_var: inner_item
